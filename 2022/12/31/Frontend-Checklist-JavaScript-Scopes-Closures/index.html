<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="1. 词法作用域 动态作用域作用域指程序源代码中定义变量的区域。作用域规定了如何查找变量，也就是确定当前执行代码对变量的访问权限。JavaScript 采用词法作用域(lexical scoping)，也就是静态作用域。  静态作用域：函数的作用域在函数定义时决定。 动态作用域：函数的作用域在函数调用时决定。  123456789var value &#x3D; 1;function foo() &amp;#123">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaScript Checklist: Scopes &amp; Closures">
<meta property="og:url" content="https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/index.html">
<meta property="og:site_name" content="Gloria&#39;s Notebook">
<meta property="og:description" content="1. 词法作用域 动态作用域作用域指程序源代码中定义变量的区域。作用域规定了如何查找变量，也就是确定当前执行代码对变量的访问权限。JavaScript 采用词法作用域(lexical scoping)，也就是静态作用域。  静态作用域：函数的作用域在函数定义时决定。 动态作用域：函数的作用域在函数调用时决定。  123456789var value &#x3D; 1;function foo() &amp;#123">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-12-31T18:27:10.000Z">
<meta property="article:modified_time" content="2023-01-06T17:08:53.910Z">
<meta property="article:author" content="Gloria Su">
<meta property="article:tag" content="JavaScript">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/iconmonstr-cat-1-240.png">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/iconmonstr-cat-1-240.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/iconmonstr-cat-1-240.png">
        
      
    
    <!-- title -->
    <title>JavaScript Checklist: Scopes &amp; Closures</title><meta name="robots" content="noindex">
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Gloria's Notebook" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
  <div id="wallpaper" style="background-image: url(&quot;https://s2.loli.net/2023/03/29/y6h1NuejsoG3JYI.png&quot;);background-size: auto;background-repeat: repeat;position: absolute;inset: 0;background-position: center;"></div>
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/Beking0912">Projects</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&text=JavaScript Checklist: Scopes &amp; Closures"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&title=JavaScript Checklist: Scopes &amp; Closures"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&is_video=false&description=JavaScript Checklist: Scopes &amp; Closures"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=JavaScript Checklist: Scopes &amp; Closures&body=Check out this article: https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&title=JavaScript Checklist: Scopes &amp; Closures"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&title=JavaScript Checklist: Scopes &amp; Closures"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&title=JavaScript Checklist: Scopes &amp; Closures"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&title=JavaScript Checklist: Scopes &amp; Closures"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&name=JavaScript Checklist: Scopes &amp; Closures&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&t=JavaScript Checklist: Scopes &amp; Closures"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%AF%8D%E6%B3%95%E4%BD%9C%E7%94%A8%E5%9F%9F-%E5%8A%A8%E6%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">1.</span> <span class="toc-text">1. 词法作用域 动态作用域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE"><span class="toc-number">2.</span> <span class="toc-text">2. 作用域和作用域链</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E6%A0%88"><span class="toc-number">3.</span> <span class="toc-text">3. 执行上下文栈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-this-%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%8F%96%E5%80%BC"><span class="toc-number">4.</span> <span class="toc-text">4. this 的原理及取值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%97%AD%E5%8C%85%E7%9A%84%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">5. 闭包的原理与实际应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%A0%86%E6%A0%88%E6%BA%A2%E5%87%BA%E5%92%8C%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F"><span class="toc-number">6.</span> <span class="toc-text">6. 堆栈溢出和内存泄漏</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%A4%84%E7%90%86%E5%BE%AA%E7%8E%AF%E7%9A%84%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C"><span class="toc-number">7.</span> <span class="toc-text">7. 处理循环的异步操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-number">8.</span> <span class="toc-text">8. 模块化</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        JavaScript Checklist: Scopes &amp; Closures
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Gloria Su</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-12-31T18:27:10.000Z" itemprop="datePublished">2022-12-31</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="1-词法作用域-动态作用域"><a href="#1-词法作用域-动态作用域" class="headerlink" title="1. 词法作用域 动态作用域"></a>1. 词法作用域 动态作用域</h2><p>作用域指程序源代码中定义变量的区域。<br>作用域规定了如何查找变量，也就是确定当前执行代码对变量的访问权限。<br>JavaScript 采用词法作用域(lexical scoping)，也就是静态作用域。</p>
<ul>
<li><strong>静态作用域</strong>：函数的作用域在<strong>函数定义时</strong>决定。</li>
<li><strong>动态作用域</strong>：函数的作用域在<strong>函数调用时</strong>决定。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> value = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> value = <span class="number">2</span>;</span><br><span class="line">    <span class="title function_">foo</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">bar</span>();</span><br></pre></td></tr></table></figure>
<p>假设采用<strong>静态作用域</strong>，执行过程：<br>执行 foo 函数，先从 foo 函数内部查找是否有局部变量 value，如果没有，就根据书写的位置，查找上面一层的代码，也就是 value 等于 1，所以结果会打印 1。</p>
<p>假设采用<strong>动态作用域</strong>，执行过程：<br>执行 foo 函数，依然是从 foo 函数内部查找是否有局部变量 value。如果没有，就从调用函数的作用域，也就是 bar 函数内部查找 value 变量，所以结果会打印 2。</p>
<p>JS 采用的是静态作用域，函数的作用域基于函数创建的位置，因此结果是 1。</p>
<h2 id="2-作用域和作用域链"><a href="#2-作用域和作用域链" class="headerlink" title="2. 作用域和作用域链"></a>2. 作用域和作用域链</h2><ol>
<li><strong>全局作用域</strong>：全局作用域下声明的变量可以在程序的任意位置访问。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> greeting = <span class="string">&#x27;Hello World!&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">greet</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(greeting);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">greet</span>(); <span class="comment">// &#x27;Hello World!&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li><strong>函数作用域</strong>：也叫局部作用域。在函数内部声明的变量只能在函数内部访问。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">greet</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> greeting = <span class="string">&#x27;Hello World!&#x27;</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(greeting);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">greet</span>(); <span class="comment">// &#x27;Hello World!&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(greeting); <span class="comment">// Uncaught ReferenceError: greeting is not defined</span></span><br></pre></td></tr></table></figure></li>
<li><strong>块级作用域</strong>：在大括号中使用 let 和 const 声明的变量存在于块级作用域中，在大括号之外不能访问这些变量。使用var声明的变量不存在块级作用域中。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> greeting = <span class="string">&#x27;Hello World!&#x27;</span>;</span><br><span class="line">  <span class="keyword">var</span> lang = <span class="string">&#x27;English&#x27;</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(greeting); <span class="comment">// &#x27;Hello World!&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(lang); <span class="comment">// &#x27;English&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(greeting); <span class="comment">// Uncaught ReferenceError: greeting is not defined</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>作用域链</strong>：JS 上每一个函数执行时，会先在自己创建的 AO 上找对应属性值。若找不到则往父函数的 AO 上找，再找不到则再上一层的 AO ,直到找到 window（全局作用域）。</p>
<h2 id="3-执行上下文栈"><a href="#3-执行上下文栈" class="headerlink" title="3. 执行上下文栈"></a>3. 执行上下文栈</h2><p>JavaScript 引擎并非一行一行地分析和执行程序，而是一段一段地分析执行。当执行一段代码的时候，会进行一个“准备工作”，也就是执行上下文(execution context)。</p>
<ol>
<li><strong>变量提升</strong>：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example 1</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;foo1&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>();  <span class="comment">// foo1</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;foo2&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>(); <span class="comment">// foo2</span></span><br></pre></td></tr></table></figure></li>
<li><strong>函数提升</strong>：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example 2</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;foo1&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>();  <span class="comment">// foo2</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;foo2&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">foo</span>(); <span class="comment">// foo2</span></span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><p><strong>可执行代码 executable code</strong> 的类型：全局代码、函数代码、eval代码。</p>
<ol>
<li><strong>全局执行上下文</strong><br>  不在任何函数中的代码都位于全局执行上下文中。一个程序中只能存在一个全局执行上下文。<br>  创建一个全局对象，在浏览器中这个全局对象就是 window 对象，并将 this 指针指向全局对象。</li>
<li><strong>函数执行上下文</strong><br>  每次调用函数时，都会为该函数创建一个新的执行上下文。<br>  每个函数都拥有自己的执行上下文，但是只有在函数<strong>被调用时</strong>才会被创建。<br>  每当一个新的执行上下文被创建，它都会按照特定的顺序执行一系列步骤。</li>
<li><strong>Eval 函数执行上下文</strong><br>  运行在 eval 函数中的代码获得了自己的执行上下文。</li>
</ol>
</li>
<li><p><strong>执行栈</strong>具有 LIFO（后进先出）结构，用于存储在代码执行期间创建的所有执行上下文。</p>
<ol>
<li>当 JavaScript 引擎首次读取脚本时，它会创建一个全局执行上下文并将其推入当前的执行栈。</li>
<li>每当发生一个函数调用，引擎都会为该函数创建一个新的执行上下文并将其推到当前执行栈的顶端。</li>
<li>引擎会运行执行上下文在执行栈顶端的函数。</li>
<li>当此函数运行完成后，其对应的执行上下文将会从执行栈中弹出，上下文控制权将移到当前执行栈的下一个执行上下文。</li>
</ol>
</li>
</ul>
<h2 id="4-this-的原理及取值"><a href="#4-this-的原理及取值" class="headerlink" title="4. this 的原理及取值"></a>4. this 的原理及取值</h2><p><strong>绑定规则</strong>：默认绑定、隐式绑定、显式绑定、new 绑定。<strong>优先级从低到高</strong>。<br>箭头函数的 this 绑定取决于外层（函数或全局）作用域。</p>
<ol>
<li><p><strong>默认绑定</strong><br>在严格模式下（strict mode），全局对象将无法使用默认绑定，即执行会报 undefined。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123; </span><br><span class="line">    <span class="comment">// &quot;use strict&quot;; </span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="title function_">foo</span>(); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>隐式绑定</strong><br>foo 函数被当做引用属性，被添加到 obj 对象上。获取 obj.foo 属性，this 进行了隐式绑定，所以 this.a 被解析成了 obj.a。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> obj = &#123; </span><br><span class="line">    <span class="attr">a</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">foo</span>: foo </span><br><span class="line">&#125;;</span><br><span class="line">obj.<span class="title function_">foo</span>(); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>多层调用链</strong><br>获取 obj1.obj2 -&gt; 通过引用获取到 obj2，再访问 obj2.foo -&gt; 最后执行 foo 函数调用。<br>这里调用链不只一层，存在 obj1、obj2 两个对象，那么隐式绑定具体会绑哪个对象。<br>这里原则是<strong>获取最后一层调用的上下文对象</strong>，即 obj1，所以结果是（obj1.a）。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> obj1 = &#123; </span><br><span class="line">    <span class="attr">a</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="attr">foo</span>: foo </span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123; </span><br><span class="line">    <span class="attr">a</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">obj1</span>: obj1</span><br><span class="line">&#125;;</span><br><span class="line">obj2.<span class="property">obj1</span>.<span class="title function_">foo</span>(); <span class="comment">// 4 </span></span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><strong>隐式丢失（函数别名）</strong><br>通过 bar 找到 foo 函数进行调用。整个调用过程并没有 obj 的参数，所以是默认绑定，全局属性 a。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> obj = &#123; </span><br><span class="line">    <span class="attr">a</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">foo</span>: foo </span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> bar = obj.<span class="property">foo</span>;</span><br><span class="line"><span class="title function_">bar</span>(); <span class="comment">// 2 </span></span><br></pre></td></tr></table></figure></li>
<li><strong>隐式丢失（回调函数）</strong><br>因为是引用关系，所以传参实际上传的就是 foo 对象本身的引用。对于 setTimeout 的调用，还是 setTimeout -&gt; 获取参数中 foo 的引用参数 -&gt; 执行 foo 函数，中间没有 obj 的参与。这里依旧进行的是默认绑定。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> obj = &#123; </span><br><span class="line">    <span class="attr">a</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">foo</span>: foo </span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">setTimeout</span>(obj.<span class="property">foo</span>, <span class="number">100</span>); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li><strong>显式绑定</strong><br>显示的申明了要绑定的对象。call 与 apply 是同样的作用，区别只是其他参数的设置上。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> obj1 = &#123; </span><br><span class="line">    <span class="attr">a</span>: <span class="number">3</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123; </span><br><span class="line">    <span class="attr">a</span>: <span class="number">4</span>,</span><br><span class="line">&#125;;</span><br><span class="line">foo.<span class="title function_">call</span>(obj1); <span class="comment">// 3</span></span><br><span class="line">foo.<span class="title function_">call</span>(obj2); <span class="comment">// 4</span></span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><strong>硬绑定</strong><br>foo 因为通过 foo.call(obj1) 已经显示绑定了 obj1，所以在 foo 函数内 this 指向的是 obj1，不会因为 bar 函数内指向 obj2 而改变自身。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> obj1 = &#123; </span><br><span class="line">    <span class="attr">a</span>: <span class="number">3</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123; </span><br><span class="line">    <span class="attr">a</span>: <span class="number">4</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> bar = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    foo.<span class="title function_">call</span>(obj1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">setTimeout</span>(bar, <span class="number">100</span>); <span class="comment">// 3</span></span><br><span class="line">bar.<span class="title function_">call</span>(obj2); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="4">
<li><strong>new 绑定</strong><br>每次调用生成的是全新的对象，该对象又会自动绑定到 this 上。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a</span>) &#123; </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">a</span> = a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> bar1 = <span class="keyword">new</span> <span class="title function_">foo</span>(<span class="number">3</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bar1.<span class="property">a</span>); <span class="comment">// 3</span></span><br><span class="line"><span class="keyword">var</span> bar2 = <span class="keyword">new</span> <span class="title function_">foo</span>(<span class="number">4</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(bar2.<span class="property">a</span>); <span class="comment">// 4</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="5-闭包的原理与实际应用"><a href="#5-闭包的原理与实际应用" class="headerlink" title="5. 闭包的原理与实际应用"></a>5. 闭包的原理与实际应用</h2><p>闭包是一个函数，而且存在于另一个函数当中。<br>闭包可以访问到父级函数的变量，且该变量<strong>不会被垃圾回收机制销毁</strong>。</p>
<ul>
<li><strong>原理</strong>：利用了作用域链的特性。在当前执行环境下访问某个变量时，如果不存在就一直向外层寻找。</li>
<li><strong>优点</strong>：<ol>
<li>方便读取函数内部的变量。</li>
<li>隐藏变量，避免全局污染。</li>
</ol>
</li>
<li><strong>缺点</strong>： <ol>
<li>导致变量不会被垃圾回收机制回收，造成内存消耗。</li>
<li>不恰当的使用闭包可能会造成内存泄漏。</li>
</ol>
</li>
</ul>
<p><strong>需求：实现 age 自增。</strong></p>
<ol>
<li>通过把变量封装到函数内，让它成为局部变量，来避免全局变量被污染：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> age = <span class="number">18</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">cat</span>(<span class="params"></span>)&#123;</span><br><span class="line">    age++;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(age);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">cat</span>(); <span class="comment">// 19</span></span><br><span class="line"><span class="title function_">cat</span>(); <span class="comment">// 20</span></span><br><span class="line"><span class="title function_">cat</span>(); <span class="comment">// 21</span></span><br><span class="line"><span class="title function_">cat</span>(); <span class="comment">// 22</span></span><br></pre></td></tr></table></figure></li>
<li>定义一个局部变量，不污染全局，但是实现不了递增。<br>每次调用函数 person 进入该作用域，变量 age 就会重新赋值为 18：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">person</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> age = <span class="number">18</span>;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">cat</span>(<span class="params"></span>)&#123;</span><br><span class="line">        age++;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(age);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cat;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">person</span>(); <span class="comment">// 19</span></span><br><span class="line"><span class="title function_">person</span>(); <span class="comment">// 19</span></span><br></pre></td></tr></table></figure></li>
<li>通过闭包，可以使函数内部局部变量递增，不会影响全部变量。<br>每次调用不在经过 age 的初始：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> per = <span class="title function_">person</span>();</span><br><span class="line"><span class="title function_">per</span>(); <span class="comment">// 19</span></span><br><span class="line"><span class="title function_">per</span>(); <span class="comment">// 20</span></span><br><span class="line"><span class="title function_">per</span>(); <span class="comment">// 21</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>为什么使用闭包时变量不会被垃圾回收机制收销毁？</strong><br>按照作用域链的特点，闭包（函数）外面的变量不会被销毁，因为函数会一直被调用，所以一直存在。</p>
<h2 id="6-堆栈溢出和内存泄漏"><a href="#6-堆栈溢出和内存泄漏" class="headerlink" title="6. 堆栈溢出和内存泄漏"></a>6. 堆栈溢出和内存泄漏</h2><ul>
<li><strong>内存泄露</strong>：申请的内存执行完后没有及时的清理或者销毁，占用空闲内存。内存泄露过多就会导致后面的程序申请不到内存。因此内存泄露会导致内部内存溢出。</li>
<li><strong>堆栈溢出</strong>：内存空间已经被申请完，没有足够的内存提供。</li>
<li><strong>常见原因</strong>：<ol>
<li>全局变量引起的内存泄露。</li>
<li>闭包。</li>
<li>没有被清除的计时器。</li>
</ol>
</li>
<li><strong>解决方法</strong>：<ol>
<li>减少不必要的全局变量。</li>
<li>减少闭包的使用。</li>
<li>避免死循环的发生。</li>
</ol>
</li>
</ul>
<h2 id="7-处理循环的异步操作"><a href="#7-处理循环的异步操作" class="headerlink" title="7. 处理循环的异步操作"></a>7. 处理循环的异步操作</h2><p><strong>利用 Promise.all</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">time</span>(<span class="string">&quot;promise all in&quot;</span>);</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>(</span><br><span class="line">  arr.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">doAsync</span>(item * <span class="number">100</span>).<span class="title function_">then</span>(<span class="title function_">print</span>(<span class="string">`<span class="subst">$&#123;item&#125;</span>-promise`</span>));</span><br><span class="line">  &#125;)</span><br><span class="line">).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">timeEnd</span>(<span class="string">&quot;promise all in&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>利用 async&#x2F;await</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">async</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">time</span>(<span class="string">&quot;async/await all in&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> <span class="keyword">await</span> (<span class="keyword">let</span> i <span class="keyword">of</span> arr.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">doAsync</span>(item * <span class="number">100</span>).<span class="title function_">then</span>(<span class="title function_">print</span>(<span class="string">`<span class="subst">$&#123;item&#125;</span>-async/await`</span>));</span><br><span class="line">  &#125;)) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">timeEnd</span>(<span class="string">&quot;async/await all in&quot;</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<h2 id="8-模块化"><a href="#8-模块化" class="headerlink" title="8. 模块化"></a>8. 模块化</h2><ol>
<li><p><strong>Module 设计模式</strong><br>使用匿名函数自调用(闭包)来封装，通过自定义暴露行为来区分私有成员和公有成员。解决全局作用域的污染问题。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myModule = (<span class="keyword">function</span> (<span class="params"><span class="variable language_">window</span></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> moduleName = <span class="string">&#x27;module&#x27;</span>  <span class="comment">// private</span></span><br><span class="line">    <span class="comment">// public</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">setModuleName</span>(<span class="params">name</span>) &#123;</span><br><span class="line">      moduleName = name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// public</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">getModuleName</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> moduleName</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123; setModuleName, getModuleName &#125;  <span class="comment">// 暴露行为</span></span><br><span class="line">&#125;)(<span class="variable language_">window</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>CommonJS</strong><br>采用<strong>同步方式加载</strong>模块。每个文件就是一个模块，都有自己的一个作用域。通过 module.exports 暴露 public 成员。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件名：x.js</span></span><br><span class="line"><span class="keyword">let</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span>) &#123;</span><br><span class="line">  x++;</span><br><span class="line">  <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">x</span> = x;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">add</span> = add;</span><br></pre></td></tr></table></figure>
<p>通过 require() 引入模块依赖。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件名：main.js</span></span><br><span class="line"><span class="keyword">let</span> xm = <span class="built_in">require</span>(<span class="string">&#x27;./x.js&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(xm.<span class="property">x</span>);  <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(xm.<span class="title function_">add</span>());  <span class="comment">// 2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(xm.<span class="property">x</span>);   <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>AMD &amp; require.js</strong><br>AMD 推崇<strong>依赖前置、提前执行</strong>，采用<strong>异步方式加载</strong>模块。<br>定义的模块是被当作回调函数来执行的，依赖于 require.js 模块管理工具库。require.js 在申明依赖的模块时，会在第一时间加载并执行模块内代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">define</span>([<span class="string">&#x27;module1&#x27;</span>, <span class="string">&#x27;module2&#x27;</span>], <span class="keyword">function</span>(<span class="params">m1, m2, b</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> x = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params"></span>) &#123;</span><br><span class="line">    x += <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 等于在最前面声明并初始化了要用到的所有模块</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">    b.<span class="title function_">foo</span>() <span class="comment">// 即便没用到某个模块 b，但 b 还是提前执行了</span></span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">return</span> &#123; add &#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>CMD &amp; sea.js</strong><br>CMD 推崇<strong>依赖就近、延迟执行</strong>。<br>CMD 集成了 CommonJS 和 AMD 的特点，<strong>支持同步和异步加载</strong>模块。<br>CMD 加载完某个依赖模块后并不执行，只是下载。在所有依赖模块加载完成后进入主逻辑，遇到 require 语句的时候才执行对应的模块，模块的<strong>执行顺序和书写顺序完全一致</strong>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">&#x27;./a&#x27;</span>); <span class="comment">// 同步加载模块</span></span><br><span class="line">  a.<span class="title function_">doSomething</span>();</span><br><span class="line">  <span class="comment">// 异步加载一个模块，在加载完成时，执行回调</span></span><br><span class="line">  <span class="built_in">require</span>.<span class="title function_">async</span>([<span class="string">&#x27;./b&#x27;</span>], <span class="keyword">function</span>(<span class="params">b</span>) &#123;</span><br><span class="line">    b.<span class="title function_">doSomething</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 对外暴露成员</span></span><br><span class="line">  <span class="built_in">exports</span>.<span class="property">doSomething</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line">&#125;);</span><br><span class="line">seajs.<span class="title function_">use</span>(<span class="string">&#x27;path&#x27;</span>); <span class="comment">// 使用模块</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ES6 module</strong><br>export 用于规定模块的对外接口，import 用于输入其他模块提供的功能。<br>ES6 的模块不是对象，import 命令会被 JavaScript 引擎静态分析，在编译时就引入模块代码，而不是在代码运行时加载，所以<strong>无法实现条件加载</strong>。</p>
</li>
</ol>
<hr>
<p>References:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903830887366670#heading-4">https://juejin.cn/post/6844903830887366670#heading-4</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903988274397197">https://juejin.cn/post/6844903988274397197</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/mqyqingfeng/Blog/issues/3">https://github.com/mqyqingfeng/Blog/issues/3</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000021725949">https://segmentfault.com/a/1190000021725949</a></li>
</ul>
<!-- flag of hidden posts -->
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/Beking0912">Projects</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%AF%8D%E6%B3%95%E4%BD%9C%E7%94%A8%E5%9F%9F-%E5%8A%A8%E6%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">1.</span> <span class="toc-text">1. 词法作用域 动态作用域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE"><span class="toc-number">2.</span> <span class="toc-text">2. 作用域和作用域链</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E6%A0%88"><span class="toc-number">3.</span> <span class="toc-text">3. 执行上下文栈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-this-%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%8F%96%E5%80%BC"><span class="toc-number">4.</span> <span class="toc-text">4. this 的原理及取值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%97%AD%E5%8C%85%E7%9A%84%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">5. 闭包的原理与实际应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%A0%86%E6%A0%88%E6%BA%A2%E5%87%BA%E5%92%8C%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F"><span class="toc-number">6.</span> <span class="toc-text">6. 堆栈溢出和内存泄漏</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%A4%84%E7%90%86%E5%BE%AA%E7%8E%AF%E7%9A%84%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C"><span class="toc-number">7.</span> <span class="toc-text">7. 处理循环的异步操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-number">8.</span> <span class="toc-text">8. 模块化</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&text=JavaScript Checklist: Scopes &amp; Closures"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&title=JavaScript Checklist: Scopes &amp; Closures"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&is_video=false&description=JavaScript Checklist: Scopes &amp; Closures"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=JavaScript Checklist: Scopes &amp; Closures&body=Check out this article: https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&title=JavaScript Checklist: Scopes &amp; Closures"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&title=JavaScript Checklist: Scopes &amp; Closures"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&title=JavaScript Checklist: Scopes &amp; Closures"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&title=JavaScript Checklist: Scopes &amp; Closures"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&name=JavaScript Checklist: Scopes &amp; Closures&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://beking0912.github.io/2022/12/31/Frontend-Checklist-JavaScript-Scopes-Closures/&t=JavaScript Checklist: Scopes &amp; Closures"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023
    Gloria Su
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/Beking0912">Projects</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
